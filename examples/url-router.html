<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title></title>
<style>
h1 { border-bottom: 2px solid #ccc; padding-bottom: 5px; }
.panel { display: none; width: 100%; padding: 10px; height: 400px; }
.panel.on { display: block; }
#menu { border-bottom: 1px #eee; width: 100%; height: 40px; }
#menu li { float: left; width: 100px;  }

#a { background-color: yellow; }
#b { background-color: red; }
#c { background-color: orange; }
</style>
</head>
<body>

<div id="main">
  <h1>MVVM && Backbone.Router -- DEMO</h1>
  <ul id="menu">
    <li><a href="#a">page-a</a></li>
    <li><a href="#b">page-b</a></li>
    <li><a href="#c">page-c</a></li>
  </ul>

  <div class="panel" id="a">
    <p vm="html:welcome"></p>
  </div>
  <div class="panel" id="b" vm="html:welcome">
    <p vm="html:welcome"></p>
  </div>
  <div class="panel" id="c" vm="html:welcome">
    <p vm="html:welcome"></p>
  </div>
</div>

<script src="../spm_modules/seajs/2.3.0/dist/sea.js?nowrapper"></script>
<!-- <script src="../spm_modules/seajs-combo/1.0.1/dist/seajs-combo.js?nowrapper"></script> -->
<script>
seajs.config({base:'../'});
define("a", function(require, exports, module){
  var VM = require("src/backbone.vm");
  var A = VM.extend({
    el: "#a",
    defaults: {
      welcome: "here is panel a"
    }
  });
  new A;
});

define("b", function(require, exports, module){
  var VM = require("src/backbone.vm");
  var B = VM.extend({
    el: "#b",
    defaults: {
      welcome: "here is panel b"
    }
  });
  new B;
});

define("c", function(require, exports, module){
  var VM = require("src/backbone.vm");
  var C = VM.extend({
    el: "#c",
    defaults: {
      welcome: "here is panel c"
    }
  });

  new C;
});


define("init", function(require){
  var $        = require("jquery/1.10.2/jquery.js");
  var Backbone = require("backbone/1.1.2/backbone.js");

  var R = Backbone.Router.extend({
    routes: {
      "": "default",
      ":action": "dispatch"
    },

    initialize: function() {
      this.panel = $('.panel');
    },

    default: function() {
      this.dispatch("a");
    },

    /*
    Dispatch pannels
     */
    action: "a",
    dispatch: function(action) {
      var it = this;
      this.action = action;
      require.async(action, function(c) {
        it.panel.filter(".on").fadeOut(300, function(){
          $(this).removeClass("on");
        });

        setTimeout(function(){
          it.panel.filter('#' + action).fadeIn(300).addClass('on');
        }, 300);
      });
    },
    goto: function(action) {
      this.navigate('#/' + action, { trigger: true });
    }
  });

  // start when domready
  $(document).ready(function(){ new R; Backbone.history.start(); });
});

// start app init
seajs.use("init");

</script>

</body>
</html>