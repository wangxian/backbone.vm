define("backbone.vm/1.2.0/src/backbone.vm",["jquery/1.10.2/jquery","underscore/1.6.0/underscore","backbone/1.1.2/backbone"],function(t,e,n){var i=t("jquery/1.10.2/jquery"),r=t("underscore/1.6.0/underscore"),s=t("backbone/1.1.2/backbone"),o=/\s+/g,a={simple:function(t,e,n){return function(i){r.each(n,function(t){i=t(i)}),t[e](i)}},simpleOnChange:function(t,e){return function(){t.set(e,this.value)}},show:function(t){return function(e){t[e?"show":"hide"]()}},remove:function(t){return function(e){e&&t.remove()}},className:function(t,e,n){return function(i,s){var o;r.each(n,function(t){i=t(i)}),r.isArray(i)?(o=i[0],i=i[1]):o=s.previous(e),o&&t.removeClass(o),i&&t.addClass(i)}},checkboxOnClick:function(t,e){return function(){var n=t.get(e),i=this.value;r.isArray(n)||(n=[]),this.checked?n.push(i):n=r.filter(n,function(t){return t!==i}),t.set(e,n,{silent:!0});var s;(s={})[e]=n,t._vm.changed=s,t.trigger("change:"+e)}},checkbox:function(t){return function(e){if(r.isArray(e))for(var n in t)t[n].checked=r.contains(e,n)?!0:!1}},radio:function(t){return function(e){e=e.toString();for(var n in t)t[n].checked=n!==e?!1:!0}},bindEventListener:function(t,e){return"function"==typeof t[e]?r.bind(t[e],t):function(){}},bindForListener:function(t,e,n,i){return"function"==typeof t[e]?function(s){r.bind(t[e],t)(s,n,i)}:function(){}},forTemplate:function(t,e){var n=t.html().match(/<!--([\s\S]*)-->/g);n=null!==n?n[0].replace(/<!--|-->/g,""):"";var s=r.template(n);return function(n,c){t.empty(),r.each(e,function(t){n=t(n)});var u=r.clone(c._filter);r.each(n,function(e,n){u.$key=n,u.$value=e;var l=i(s(u));t.append(l);var f=l.length>1?l.filter("[vm]"):l.find("[vm]");f.each(function(t,e){var s=i(e),u=e.getAttribute("vm").replace(o,"").split(",");r.each(u,function(t){var e=t.split(":"),i=e[1].split("=");"on"===e[0]&&s.on(i[0],a.bindForListener(c,i[1],n,l))})})})}},parseFilter:function(t,e){return r.map(e,function(e){var n=e.split("#"),i=n.shift();return function(e){var s=n.concat();return s.unshift(e),t._filter[i]?t._filter[i].apply(t,s):r[i]?r[i].apply(null,s):void 0}})}},c=s.VM=function(t){this.cid=r.uniqueId("vm"),t||(t={}),this._filter=r.extend({},this._filterDefault,this.filter),this._attrs={},this._input={radio:{},checkbox:{}},this.$el=i(this.el),this._vm=new s.Model,this._scanAttrs(),this._vm.on("change",this._updateVM,this),this.initialize.apply(this,arguments),this._vm.set(this.defaults)};r.extend(c.prototype,{el:"body",defaults:{},$:function(t){return this.$el.find(t)},_filterDefault:{uppercase:function(t){return t.toUpperCase()},lowercase:function(t){return t.toLowerCase()},json:function(t,e){return JSON.stringify(t,null,e?"  ":null)}},initialize:function(){},_updateVM:function(t){var e=r.pick(this._attrs,r.keys(t.changed)),n=this;r.each(e,function(e,i){r.each(e,function(e){e(t.get(i),n)})})},_scanAttrs:function(){var t=this;this.$el.find("[vm]").each(function(e,n){var s=n.getAttribute("vm").replace(o,"");if(s){var c=s.split(",");r.each(c,function(e){var s=e.split(":"),o=s[0],c=s[1].split("|"),u=c.shift();if("on"===o){var l=u.split("=");i(n).on(l[0],a.bindEventListener(t,l[1])).attr("vm-dombind","")}else if("show"===o)t._attrs[u]=[a.show(i(n))];else if("remove"===o)t._attrs[u]=[a.remove(i(n))];else if("class"===o)t._attrs[u]||(t._attrs[u]=[]),t._attrs[u].push(a.className(i(n),u,a.parseFilter(t,c)));else if("for"===o)t._attrs[u]||(t._attrs[u]=[]),t._attrs[u].push(a.forTemplate(i(n),a.parseFilter(t,c)));else if(r.contains(["html","text","val","css"],o)){if(t._attrs[u]||(t._attrs[u]=[]),"radio"===n.type||"checkbox"===n.type)if(t._input[n.type][u])t._input[n.type][u][n.value]=n;else{var f={};f[n.value]=n,t._input[n.type][u]=f,t._attrs[u].push(a[n.type](t._input[n.type][u]))}else t._attrs[u].push(a.simple(i(n),o,a.parseFilter(t,c)));"INPUT"!==n.nodeName&&"SELECT"!==n.nodeName||"val"!==o||("radio"===n.type?i(n).on("click",a.simpleOnChange(t,u)).attr("vm-dombind",""):"checkbox"===n.type?i(n).on("click",a.checkboxOnClick(t,u)).attr("vm-dombind",""):i(n).on("change",a.simpleOnChange(t,u)).attr("vm-dombind",""))}})}})},get:function(t){return this._vm.get(t)},set:function(t,e,n){"undefined"==typeof n&&(n={});var i=n.silent,s=n.unset;if("object"==typeof t)this._vm.set(t,n);else{var o=t.search(/\[|\./);if(-1===o)this._vm.set(t,e,n);else{var a=t;t=a.slice(0,o);var c=a.slice(o),u=this._vm.attributes[t],l="";if(s){var f=Math.max(c.lastIndexOf("."),c.lastIndexOf("[")),h=c.slice(0,f),v=c.slice(f+1,-1);l="if(Object.prototype.toString.call(obj"+h+') === "[object Array]"){ obj'+h+".splice("+v+",1); }else{ delete obj"+c+";}"}else l="obj"+c+"=value;";try{var p=new Function("obj,value",l);p(u,e),this._vm._previousAttributes=r.clone(this._vm.attributes);var m={};m[t]=e,this._vm.changed=m,i||this.trigger("change:"+t)}catch(d){throw new Error("update "+t+c+" error, source="+l)}}}return this},unset:function(t,e){return e=r.extend({},e,{unset:!0}),this.set(t,null,e)},on:function(t,e,n){n||(n=this),this._vm.on(t,e,n)},off:function(t,e,n){n||(n=this),this._vm.off(t,e,n)},once:function(t,e,n){n||(n=this),this._vm.once(t,e,n)},previous:function(t){return this._vm.previous(t)},trigger:function(t){var e=[this._vm].concat([].slice.call(arguments,1)),n=t.split(":");"change"===n[0]&&(2===n.length?(this._vm.trigger.apply(this._vm,[t].concat(e)),this._vm.changed=r.pick(this._vm.attributes,n[1]),t=n[0]):1===n.length&&(this._vm.changed=this._vm.attributes)),this._vm.trigger.apply(this._vm,[t].concat(e))},toJSON:function(){return this._vm.toJSON()},destroy:function(){this._vm.off(null,null,this),this.$el.find("[vm-dombind]").off(),this.$el=null,this._vm=null,this._attrs=null,this._input=null}}),c.extend=s.Model.extend,n.exports=c});